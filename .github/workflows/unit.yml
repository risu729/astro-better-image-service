name: Unit Test

on:
  pull_request:
  workflow_call:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * SUN'

permissions: {}

defaults:
  run:
    shell: bash

jobs:
  check:
    runs-on: ubuntu-24.04

    permissions:
      contents: read # for checkout
      actions: read # for actions-timeline

    steps:
      - name: actions-timeline
        # skip if the workflow is called from another workflow
        if: contains(github.workflow_ref, '/unit.yml')
        # cspell:ignore kesin
        uses: Kesin11/actions-timeline@1c2ab3f28225878ae4dd1f76d31279f16ea29e29 # v2.1.1

      - name: Checkout
        uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29 # v4.1.6

      - name: Setup bun
        uses: oven-sh/setup-bun@8f24390df009a496891208e5e36b8a1de1f45135 # v1.2.1

      - name: Setup Node.js
        # Install to use the latest version of Node.js when shebang is specified
        # ref: https://bun.sh/docs/cli/run#bun
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2
        with:
          node-version-file: package.json

      - name: Install Dependencies
        id: install
        run: bun install --frozen-lockfile
        env:
          HUSKY: 0

      - name: Test
        run: bun run test:unit
